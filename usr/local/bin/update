#!/bin/bash
# updates Amibian
# Copyright Â© 2020 Amibian.net
# All rights reserved

export NEWT_COLORS='
root=,white
shadow=,white
listbox=,white
roottext=black,white
window=,white
border=,white
actlistbox=red,white
button=white,black
actsellistbox=white,black
title=black,white
'
wget -q --spider http://google.com

if [ $? -eq 0 ]; then
	  cd /home/amibian/.amibian_scripts &&
	   apt-get -y update &&
	   apt-get -y upgrade &&
	   apt-get clean &&
	   apt-get -y autoremove &&
	   sudo cp -R -n /home/amibian/.amibian_scripts/usr/share/consolefonts/ /usr/share/consolefonts/ &&
	   sudo cp -R -n /home/amibian/.amibian_scripts/home/config/ /home/amibian/ &&
	   sudo cp /home/amibian/.amibian_scripts/home/.profile /home/amibian &&
	   sudo chmod -R 777 /home/amibian/.amibian_scripts &&
	   sudo chmod 777 /home/amibian/.profile &&
           sudo chmod 777 /usr/bin/raspi-config &&
	   sudo chmod -R 777 /usr/local/bin &&
	   sudo chmod -R 777 /home/amibian/Amiga/kickstarts &&
	   sudo chmod -R 777 /home/amibian/Amiga/Hard-drives_HDF &&
	   sudo chmod -R 777 /home/amibian/Amiga/Floppys_ADF &&
	   sudo chmod -R 777 /home/amibian/Amiga/CDs_ISO &&
	   sudo chmod -R 777 /home/amibian/Retro_software &&
           sudo chmod -R 777 /home/amibian/Commodore &&
           sed -i -e 's/PrivateMounts=yes/PrivateMounts=no/g' /lib/systemd/system/systemd-udevd.service &&
           git reset --hard
	   if [[ "$(git pull)" == "Already"* ]]; then
	    sudo chmod -R 777 /home/amibian/.amibian_scripts
	     whiptail --msgbox " Amibian source files are up to date. $STATUS" 20 60 1
	   else
	      sudo cp -r /home/amibian/.amibian_scripts/usr/local/bin/ /usr/local/
    	       sudo cp /home/amibian/.amibian_scripts/usr/bin/raspi-config /usr/bin

	          sudo chmod 777 /usr/bin/raspi-config &&
	           sudo chmod -R 777 /usr/local/bin &&
		    sudo chmod -R 777 /home/amibian/.amibian_scripts
		     sudo cp -R -n /home/amibian/.amibian_scripts/home/config/ /home/amibian/
	              whiptail --msgbox " Amibian updated to latest version. $status" 20 60 1
	               cd ~
	   fi
  printf "Sleeping 5 seconds before reloading raspi-config\n" &&
  sleep 5 &&
  exec raspi-config
  
  else
    whiptail --msgbox " Not connected to Internet. Please check your connection and try again." 20 60 1
fi
